<script type="text/javascript">
    function channeloptimizeClick() {
        var row = $('#master').datagrid('getSelected');
        if (row) {
            $.ajax({
                url: "/SortAllot/ChannelAllot/",
                type: "GET", 
                dataType: "text",
                data: { 'orderDate': row.OrderDate },
                success: function (responseText) {
                    var result = $.evalJSON(responseText);
                    if (result.success) {
                        $('#dlg-channeloptimize').dialog('open').dialog('setTitle', "审核");
                        $('#deliverline').datagrid({ url: '/SortAllot/GetBatchSort/?orderDate=' + row.OrderDate, singleSelect: true });
                        $('#fm-sortOrderInfo').form('load', row);
                        $('#btnEditDeliverLine').css('display', 'none');
                        $('#btnRemoveDeliverLineAllot').css('display', 'none');
                        $('#btnDeliverLineAllot').removeAttr("style");
                        
                    }
                    else {
                        $.messager.alert(g_MsgBoxTitle, result.msg, "info");
                    }
                }
            });
        }
        else {
            $.messager.alert('提示', '没有选择行！', 'info');
        }
    }

    $(function () {
        $('#deliverline').datagrid({
            onClickRow: function () {
                var row = $('#deliverline').datagrid('getSelected');
                if (row) {
                    $('#allotBillDetails').datagrid({ url: '/SortAllot/GetChannelAllot/?batchSortId=' + row.BatchSortId });

                } else {
                    $.messager.show({ title: '提示', msg: '失败!请检查原因！' });
                }
            }
        })
    });
</script>
<div id="dlg-channeloptimize" class="easyui-dialog" modal="true"
        style="width:1000px;height:400px;padding:0px 0px"
        closed="true" buttons="" >
    <div class="easyui-layout" fit="true" >
        <div region="center" split="true"  border="false" style="border-bottom-style: solid; border-bottom-width: 1px; border-bottom-color: #99BBE8">   
            <table class="easyui-datagrid" border="false" singleSelect="true" id="deliverline" url="" toolbar="#bar"
                fit="true" fitColumns="true"  pagination="true" rownumbers="true" pageSize="50">
                <thead>
                    <tr>
                        <th field="BatchSortId" width="80" hidden="true">批次分拣编号</th>
                        <th field="BatchId" width="80" hidden="true">批次编号</th>
                        <th field="OrderDate" width="100" id="operatedate">订单日期</th>
                        <th field="BatchNo" width="100" id="batchno">批次号</th>
                        <th field="BatchName" width="100" id="batchname">批次名称</th>
                        <th field="SortingLineCode" width="100" hidden="true">分拣线编码</th>
                        <th field="SortingLineName" width="100">分拣线名称</th>
                        <th field="SortingLineType" width="100">分拣线类型</th>
                    </tr>
                </thead>
            </table>
        </div>
        <div region="south" split="true" border="false" style=" height:250px; border-top-style: solid; border-top-width: 1px; border-top-color: 99BBE8;">
            <table class="easyui-datagrid" border="false" singleSelect="true" id="allotBillDetails" url=""
                fit="true" fitColumns="true"  pagination="true" rownumbers="true" pageSize="50">
                <thead>
                    <tr>
                        <th field="ChannelAllotCode" width="100" hidden="true">烟道分配代码</th>
                        <th field="BatchSortId" width="80" hidden="true">批次分拣编号</th>
                        <th field="ChannelCode" width="80">烟道代码</th>
                        <th field="ProductCode" width="80">商品代码</th>
                        <th field="ProductName" width="120">商品名称</th>
                        <th field="RealQuantity" width="50">分配数量</th>
                    </tr>
                </thead>
            </table>
        </div>
    </div>
</div>
